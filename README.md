# Solidity/IPFS Data Access Service

## About
A simple reusable data access pattern to tie an Ethereum smart contract to data stored in IPFS.  Transactional data can be stored in Ethereum while other data can be externalized to IPFS. 

My goal with this library is to help DApp developers more easily abstract this away and create a simple mechanism to programmaticaly store and access large amounts of data. This will make it far quicker to build working and testable DApps. It also makes the smart contract function like any other REST endpoint as far as the front-end is concerned. 

Over time the Ethereum/IPFS implementation details can evolve and all the CRUD DApps we build won't be coupled so tightly to the rapidly changing implementation details.

# Installation

TODO://show how the library gets set up

# Data Access Service

## Create a record
```javascript

//Create a javascript object with data you want to save.
let createdRecord = {
    firstName: "Andrew",
    lastName: "McCutchen"
}

//Call the 'create' function
let result = await dataService.create(createdRecord);


/**
* Example result
* 
{ id: 1,                                                            # id:        Generated by smart contract
  eventType: 'NEW',                                                 # eventType: NEW
  index: 0,                                                         # index:     The spot in the smart contract index where this record is stored
  ipfsCid: 'zdpuB31DmfwJYHi9FJPoSqLf9fepy6o2qcdk88t9w395b78iT',     # ipfsCid:   Generated by IPFS. 
  owner: '...your address....',                                     # owner:     Saved in smart contract    
  firstName: 'Andrew',                                              # firstName: Stored in IPFS.
  lastName: 'McCutchen'                                             # lastName:  Stored in IPFS.    
}
*/
```

## Read a record by id
```javascript

//Pass the id created above to the read function. The id was 1.
let record = await dataService.read(1);

/**
* Example record
* 
{ id: 1,                                                            # id:        Generated by smart contract
  index: 0,                                                         # index:     The spot in the smart contract index where this record is stored
  ipfsCid: 'zdpuB31DmfwJYHi9FJPoSqLf9fepy6o2qcdk88t9w395b78iT',     # ipfsCid:   Generated by IPFS. 
  owner: '...your address....',                                     # owner:     Saved in smart contract    
  firstName: 'Andrew',                                              # firstName: Stored in IPFS.
  lastName: 'McCutchen'                                             # lastName:  Stored in IPFS.    
}
*/
```


## Read a record by index
```javascript

//We've created one record. Indexing begins at 0. 
let record = await dataService.readByIndex(0);

/**
* Example record. This is the same record as the above example.
* 
{ id: 1,                                                            # id:        Generated by smart contract
  index: 0,                                                         # index:     The spot in the smart contract index where this record is stored
  ipfsCid: 'zdpuB31DmfwJYHi9FJPoSqLf9fepy6o2qcdk88t9w395b78iT',     # ipfsCid:   Generated by IPFS. 
  owner: '...your address....',                                     # owner:     Saved in smart contract    
  firstName: 'Andrew',                                              # firstName: Stored in IPFS.
  lastName: 'McCutchen'                                             # lastName:  Stored in IPFS.    
}
*/


```



## Update a record
```javascript

// Record 1 is currently Andrew McCutchen. Change the first name to Charlie and the last name to Morton.
let record = {
    firstName: "Charlie",      
    lastName: "Morton"
}

// Update it in ethereum and IPFS.
await dataService.update( 1, record)

// Get it by ID. It will list Charlie Morton.
let updatedRecord = await dataService.read(1);

/**
 * Example updatedRecord 
    { 
        id: 1,
        owner: '...your address...',
        ipfsCid: 'zdpuAmRyFGYaKdVmEH3uwqzjv8RdSJmnrABkaSizvAu9JBivG',
        index: 1,
        lastName: 'Morton',
        firstName: 'Charlie' }
 * 
 */ 

```


# Configurable
* IPFS gateway is configurable. You can have this be a setting chosen by the user in your app. 
    - It assumes localhost by default. 


## Tradeoffs You Make
* Anything you put in IPFS can theoretically be lost. 
    - If you are creating a financial transaction that is dependent on this data, this probably isn't the right pattern to use.
    
* You'll probably have to pay for IPFS hosting. 
    - Eventually I think this can be done via coin and the DApp itself can be in charge of paying for it. I'm not sure how feasible that is yet.

* There's some centralization risk in IPFS unless you make an effort (paid, probably) to get others to host the files. This should be mitigated over time.

* Probably really slow if talking directly to the main Ethereum network.



### Includes 

* Solidity smart contract that provides a simple CRUD service to store records. 

* Ethereum will store:
    * The ID that was generated.
    * The IPFS cid where your actual data lives.
    * Which contract owns the record, if applicable.

    This keeps gas costs low. 


* IPFS will contain:
    * A JSON representation of your data. 

* Your actual javascript app (React, Angular, whatever) won't care that it's dealing with a DApp.
    - The js files can also be deployed to IPFS.

* Makes very simple requests that can be used in your own DApps. 


### Project Structure

* **/contracts** - Solidity smart contracts
    * RecordService.sol - The primary Solidity contract that provides externally accessible create/read/update functions. 

* **/src** - The javascript library
    * **data-access-service.js** - This is the javascript class you'll get when you require() the library in your web app. Its job is to orchestrate the Ethereum and IPFS calls. It's injected with an object that can talk to the RecordService contract and an object that can talk to IPFS.

    * **record-service.js** - This javascript class is responsible for communicating with the RecordService.sol smart contract.

    * **ipfs-service.js** - This javascript class is responsible for communicating with IPFs.

* **/test** - Unit tests for record-service.js, ipfs-service.js, and integration tests using data-access-service.js







# Still very raw, unworking, and probably broken. So far.

# Setup notes
You'll need to run npm install inside react-app-template any time you deploy your contract to a new address (aka when you do 'truffle migrate').